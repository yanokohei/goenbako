<template>
  <v-dialog
    v-model="isVisibleShareLetterModal"
    @click:outside="handleCloseModal"
    max-width="320"
  >
    <v-card color="amber lighten-5">
      <v-card-title>
        <span class="m-font">レターをシェアする</span>
        <v-icon>mdi-email-edit-outline</v-icon>
      </v-card-title>
      <v-divider />
      <!-- シェア項目1 -->
    <div v-for="(letterTitle, index) in letterTitles()" :key="index">
      <v-col class="text-center mt-4">
        <div
          class="s-font"
        >{{ letterTitle.message }}</div>
        <v-card-actions class="justify-center">
          <v-btn
            color="blue"
            class="white--text"
            x-small
            @click="shareTwitterAfterSvgToPngAndUpload(letterTitle)"
          >
            <v-icon>mdi-twitter</v-icon>
            シェアする
          </v-btn>
        </v-card-actions>
      </v-col>
    </div>
      <!-- 閉じる -->
      <v-row
        justify="center"
        class="ma-4"
      >
        <v-card-actions>
          <v-btn
            large
            @click="handleCloseModal"
          >
            閉じる
          </v-btn>
        </v-card-actions>
      </v-row>
<!-- SVG要素を非表示のまま変換(本番ではhiddenにする) -->
      <div hidden>
        <svg ref="svgArea" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="600" height="314" viewBox="0 0 600 314"><g data-name="レイヤー 2"><g data-name="share letter flame"><g data-name="レイヤー 2-2"><g data-name="letter flame"><path fill="#fbf1ff" d="M0 0h600v314H0z"/><path fill="#fff" d="M77.161 38h445.678c16.519 0 29.911 12.317 29.911 27.511v160.478c0 15.194-13.392 27.511-29.911 27.511H77.161c-16.519 0-29.911-12.317-29.911-27.511V65.511C47.25 50.317 60.642 38 77.161 38Z"/></g></g><path d="M76.986 95.437h-2.5c-.069 0-.125-.112-.125-.25s.056-.25.125-.25h2.5c.069 0 .125.112.125.25s-.056.25-.125.25ZM512.032 95.387h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.07 0 .125.09.125.2s-.057.2-.125.2Zm-15.006 0h-5c-.07 0-.125-.09-.125-.2s.055-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.07 0-.125-.09-.125-.2s.055-.2.125-.2h5c.069 0 .125.09.125.2s-.06.2-.129.2Zm-15 0h-5c-.07 0-.125-.09-.125-.2s.055-.2.125-.2h5c.069 0 .125.09.125.2s-.063.2-.132.2Zm-15 0h-5c-.07 0-.125-.09-.125-.2s.055-.2.125-.2h5c.069 0 .125.09.125.2s-.066.2-.135.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.069.2-.138.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.072.2-.141.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.073.2-.142.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.074.2-.143.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.189.189 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.19.19 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.191.191 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.192.192 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.194.194 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.07 0 .125.09.125.2a.194.194 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.157.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.158.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.16.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.16.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.161.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.162.2Zm-15 0h-5c-.068 0-.125-.09-.125-.2s.057-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.163.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.163.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.164.2Zm-15 0h-5c-.068 0-.125-.09-.125-.2s.057-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.165.2ZM524.484 95.437h-2.5c-.069 0-.125-.112-.125-.25s.056-.25.125-.25h2.5c.069 0 .125.112.125.25s-.056.25-.125.25ZM76.986 130.437h-2.5c-.069 0-.125-.112-.125-.25s.056-.25.125-.25h2.5c.069 0 .125.112.125.25s-.056.25-.125.25ZM512.032 130.387h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.07 0 .125.09.125.2s-.057.2-.125.2Zm-15.006 0h-5c-.07 0-.125-.09-.125-.2s.055-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.07 0-.125-.09-.125-.2s.055-.2.125-.2h5c.069 0 .125.09.125.2s-.06.2-.129.2Zm-15 0h-5c-.07 0-.125-.09-.125-.2s.055-.2.125-.2h5c.069 0 .125.09.125.2s-.063.2-.132.2Zm-15 0h-5c-.07 0-.125-.09-.125-.2s.055-.2.125-.2h5c.069 0 .125.09.125.2s-.066.2-.135.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.069.2-.138.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.072.2-.141.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.073.2-.142.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.074.2-.143.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.189.189 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.19.19 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.191.191 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.192.192 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.194.194 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.07 0 .125.09.125.2a.194.194 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.151.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.157.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.158.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.16.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.16.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.161.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.162.2Zm-15 0h-5c-.068 0-.125-.09-.125-.2s.057-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.163.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.163.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.164.2Zm-15 0h-5c-.068 0-.125-.09-.125-.2s.057-.2.125-.2h5c.069 0 .125.09.125.2a.2.2 0 0 1-.165.2ZM524.484 130.437h-2.5c-.069 0-.125-.112-.125-.25s.056-.25.125-.25h2.5c.069 0 .125.112.125.25s-.056.25-.125.25ZM76.986 165.312h-2.5a.125.125 0 1 1 0-.25h2.5a.125.125 0 0 1 0 .25ZM512.032 165.387h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.057.2-.125.2Zm-15.006 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2ZM524.484 165.312h-2.5a.125.125 0 0 1 0-.25h2.5a.125.125 0 0 1 0 .25ZM76.986 200.312h-2.5a.125.125 0 1 1 0-.25h2.5a.125.125 0 0 1 0 .25ZM512.032 200.387h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.057.2-.125.2Zm-15.006 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2ZM524.484 200.312h-2.5a.125.125 0 0 1 0-.25h2.5a.125.125 0 0 1 0 .25ZM78.986 235.312h-2.5a.125.125 0 1 1 0-.25h2.5a.125.125 0 0 1 0 .25ZM514.032 235.387h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.057.2-.125.2Zm-15.006 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2Zm-15 0h-5c-.069 0-.125-.09-.125-.2s.056-.2.125-.2h5c.069 0 .125.09.125.2s-.051.2-.125.2ZM526.484 235.312h-2.5a.125.125 0 0 1 0-.25h2.5a.125.125 0 0 1 0 .25Z"/><path fill="#918dd7" d="M57.088 294.472c-3.835 2.475-15.907 3.447-13.487-4.043 3.376.6 10.137.884 13.405-.265Z"/><path fill="#918dd7" d="M57.393 294.382c.259.911-5.272 1.549-5.7 1.829-.474-6.18-.1-5.087 5.618-6.138Z"/><path fill="#f2d83a" d="M57 290.163c-4.155 2.046-20.7.567-9.4-3.779 3.453-.484 9.394-1.448 9.4 3.779Z"/><path fill="#231815" d="M71.018 272.479c-1.073.671-.765.413-.333-.159 2.848-5.819-5.327-1.191-1.357.484.404 6.988 7.524-1.904 1.69-.325Zm-.989-.7c-.691.489-1.172-.5-.5-.878.752-.537 1.186.55.5.873Zm2.146 2.083c-.71.978-2.45.873-.981-.433.518-.546 1.546-.419.981.428Z"/><path fill="#231815" d="M73.688 267.651c-2.323.9-.877 4.778 1.5 3.7 2.337-.887.844-4.751-1.5-3.7Zm.414 2.825c-.939-.4-.8-2.048.32-2.029 1.41.035 1.191 2.571-.322 2.029Z"/><path fill="#231815" d="M80.122 268.22c-.484.554-1.572 1.516-2.03.207 2.123-.341 3.023-.961 1.6-2.2-3.185-1.523-3.636 4.475-.378 3.757 1.086-.15 2.126-1.661.808-1.764Zm-.793-1.005c-.283.08-1.065.274-1.342.335-.05-.5 1.289-.911 1.342-.336ZM84.983 266.549c-1.527-3.507-5.029.62-2.618 2.811 1.363-.427-.612-2.882 1.15-3.1.879.082.461 1.883.639 2.453 1.216 1.706 1.006-1.595.829-2.164ZM88.624 265.35a1.556 1.556 0 0 0-.945.214c.45-7.415-2.8 4.935-.321 3.355 2.653 1.962 4.383-3.256 1.266-3.569Zm.72 2.056a.913.913 0 0 1-1.823.088.865.865 0 0 1 .025-.248.912.912 0 1 1 1.821-.1.926.926 0 0 1-.023.26Z"/><path fill="#231815" d="M93.817 268.6c1.956-3.892-4.555-2.305-1.651-1.54.188-.26 1.242-.121.912.414-6.091-.126 1.93 5.346.739 1.126Zm-.906-.253c.086.74-1.15.967-1.2.225.05-.3.821-.272 1.2-.225ZM98.937 268.805c.508-1.441-2.641-.07-2.3-.264-.093-.321 2.069-3.375.286-3.132-.272 1.042-3.144 5.193-1.359 5.469 1.307-2.821.633-.012 1.738.89 2.257-.575-1.746-2.22 1.635-2.963Z"/><path fill="#231815" d="M101.731 269.735c-2.219-1.406-4.182 2.246-2 3.438 2.206 1.421 4.155-2.245 2-3.438Zm-.474.814c1.074.6.021 2.5-1.047 1.8-1.088-.608-.053-2.494 1.047-1.8Z"/><path fill="#918dd7" d="M118.97 298.566c-1.717-3.124 1.344-13.131 4.564-5.777-.397 4.802 1.956 6.351-4.564 5.777Z"/><path fill="#f2d83a" d="M118.734 292.811a2.4 2.4 0 0 1 4.793-.258v.242Z"/><path fill="#fff" d="M118.734 292.667c1.31.351 5.77-1.116 4.794 1.584-1.307-.351-5.767 1.115-4.794-1.584Z"/><path fill="none" d="M118.037 292.559h6.193M118.037 294.287h6.193"/><path fill="#918dd7" d="M77.563 278.263a1.19 1.19 0 1 1-1.122 1.122 1.19 1.19 0 0 1 1.122-1.122Z"/><path d="M77.563 281.072a1.625 1.625 0 1 1 1.534-1.534 1.626 1.626 0 0 1-1.534 1.534Zm0-2.372a.75.75 0 1 0 .706.706.751.751 0 0 0-.706-.706Z"/><path fill="#f2d83a" d="M81.787 278.263a1.19 1.19 0 1 1-1.122 1.122 1.19 1.19 0 0 1 1.122-1.122Z"/><path d="M81.787 281.072a1.625 1.625 0 1 1 1.534-1.534 1.626 1.626 0 0 1-1.534 1.534Zm0-2.372a.75.75 0 1 0 .706.706.751.751 0 0 0-.706-.706ZM77.887 281.881c-1.231 1.314-11.877-.495-12.646 1.171-.355 1.344 9.759.369 10.268.651-.1 1.352-4.121 5.484.138 3.366.839-1.42 5.927-4.28 2.24-5.188ZM77.85 296.491c-5.306.537-10.1 1.37-12.342-3.023-5.435 4.558 14.477 7.34 12.342 3.023ZM108.04 294.193c-.363.556-1.983 1-1.774 1.693 1.369 1.948 4.651-2.479 1.774-1.693ZM115.356 295.136c-.928-.292-1.477-1.451-2.367-.9-1.243 1.345 2.898 2.874 2.367.9Z"/><path d="M115.486 289.6c-.846-2.873-2.055.6-3.46.135.279-4-2.259-4.562-1.841-.112-3.573-.085-4.376 1.343-.106 1.106.677.691-.908 9.007.959 8.877 1.916.163.3-8.185.985-8.875.977-.117 3.531.53 3.463-1.131Z"/><path d="M115.2 281.548c-.7.765-3.853 1.088-4.858.7 1.246-5.365-2.375.552-3.548 2.575.23 1.336 2.242-.454 2.823-1.378.1-.129 1.53-.186 1.572.023-.319 2.715 2.043 2.233 1.841-.113 1.321.41 4.762-.605 2.17-1.807ZM124.9 281.548c-.7.769-3.749 1.1-4.772.7 1.3-5.354-2.388.537-3.525 2.575.675 1.934 2.888-2.583 4.38-1.355-.539 2.376 2.27 2.389 1.732 0 1.112.066 4.985-.54 2.185-1.92ZM98.477 291.072c-1.32 1.86 1.9 6.682-2.019 6.4.213-.027 2.717 2.755 2.825 2.009.089-1.418 1.59-7.681-.806-8.409Z"/><path d="M97.307 295.765c.62-1.989-2.481-.149-2.847.568.605 1.609 2.171.367 2.847-.568ZM103.59 296.267a6.555 6.555 0 0 1-1.814-1.033c-3.267-.46 2.252 4.311 1.814 1.033ZM103.17 286.282c-4.574 4.783 1.385-8.432-3.351-5.372-.351.187-7.386-.641-4.924 1.017 2.045.322 5.825-1.267 4.858 2.3-.484.128-7.048-.574-4.444 1.144 1.942.328 5.22-1.221 4.445 2.056-.337.532-7.188-.547-7.026.6-.241 1.027 5.665.281 6.047.5-8.639 1.635 1.786 3.315 1.626 0 1.689.466 6.071-.592 2.769-2.245ZM91.1 290.889c-1.209 1.644-2.254.87-4.3 1.027 1.341-1.033 6.651-7.2 2.177-5.593-1.53 1.777-2.419 5.7-5.088 5.605-2.517 1.693 2.141 1.235 2.8 1.49-.718 7.618 2.45 7.629 1.732 0-.093-.233 1.872-.064 1.944-.112.923 3.082 2.661-2.196.735-2.417Z"/><path d="M83.857 286.4c2.086 2.117 5.354 2.62 1.557-.555.826-.649 8.121-6.07 3.106-5.235-.25.723-6.128 4.877-4.663 5.79ZM84.6 294.841a1.069 1.069 0 1 0 1 1 1.07 1.07 0 0 0-1-1ZM90.447 294.841a1.069 1.069 0 1 0 1 1 1.069 1.069 0 0 0-1-1Z"/><path fill="#f2d83a" d="M96.873 292.066c-1.75-1.6-3.706 1.583-1.279 1.943 1.097.063 2.73-1.109 1.279-1.943Z"/><path d="M95.648 294.447c-2.715-.056-1.635-4.255.877-3.045 2.437.856 1.075 3.103-.877 3.045Zm-.009-2.359c-2.946 1.525 2.654 2.022 1.006.351a2.111 2.111 0 0 0-1.006-.351Z"/><path fill="#918dd7" d="M101.009 291.984c1.164-.841 2.912.121 2.2 1.53-.85 1.451-4.201-.54-2.2-1.53Z"/><path d="M102.173 294.464c-1.422 0-3.41-1.77-1.356-2.868 2.536-1.763 4.445 2.642 1.356 2.868Zm-.959-2.093c-1.369.589 1.24 1.814 1.672.846.348-1.032-.86-1.387-1.676-.846ZM57.524 290.031a4.877 4.877 0 0 0-3.882-4.768c1.088-2.127-2.237-2.334-2.694-.428a.549.549 0 0 0-.752-.115c-.016.011-.029.022-.044.034-.725-2.257-4.32-.783-2.257.935-5-.687-6.35 7.757-3.758 10.157 5.349.654 15.723 2.634 13.387-5.815Zm-1.06-.227c-5.621 1.343-3.826.111-6.529-3.221 2.468-.807 2.836 1.073 3.748 2.79 1.014-.605-.2-2.4-.829-3.058a3.627 3.627 0 0 1 3.61 3.485Zm-5.07-4.764c.639-1.706 2.956-.324.78.262-.239.009-1.118.146-.78-.262Zm-3.343-.466c.483-.872 1.59.087 1.838.707-.576.23-1.935.079-1.838-.707Zm-.669 2.225c1.834-.038 3.133 1.424 3.369 3.687-3.009-.315-11.164-.268-3.369-3.687Zm-3.137 7.975c-.128-.009-.074-3.818-.121-3.87 4.519 1.051 7.42-1.52 6.747 4.679Zm12.261-.363-4.6 1.088c-.5-4.914.222-3.957 4.582-4.623-.055.058.178 3.543.009 3.535Z"/><path d="M50.2 278.877c-14.284-.207-14.285 22.928 0 22.717 14.282.206 14.284-22.93 0-22.717Zm0 21.239c-12.425.181-12.425-19.942 0-19.76 12.426-.182 12.427 19.944 0 19.762ZM125.334 288.858c-1.013-1.034-.223-4.866-3.737-2.109a.642.642 0 0 0-.889-.035l-.036.035c-1.279-1.871-4.651-.4-2.9 1.6-.783.263-2.159 1.583-.63 1.794 1.257-.708 2.519-2.176 3.991-2.127.953-.493 6.02 4.199 4.201.842Zm-5.37-1.544c-1.728.868-1.5-1.1.028-.016Zm2.528.09a1.5 1.5 0 0 1-.213-.1c1.221-1.03 2.021.669.213.096Z"/><path d="M121.135 288.893c-4.4-.648-5.109 9.367-2.687 10.7 1.108-.333 6.452.919 6.462-1.129-.11-3.021 1.082-9.642-3.775-9.571Zm0 1.422a2.419 2.419 0 0 1 2.29 1.74h-4.582a2.411 2.411 0 0 1 2.292-1.74Zm2.4 8.008c-3.695.61-5.434 1.151-4.8-3.53 3.794.23 5.365-1.362 4.797 3.53Zm0-4.539c-.372-.29-5.691.732-4.8-.725.365.292 5.695-.726 4.797.725Z"/></g></g>          <SvgStyle />
          <text
            x="12%"
            y="14%"
            class="sv-style"
            font-size="16px"
            ><tspan>> {{ title }}</tspan>
          </text>
          <foreignObject
            x="16%" y="20%" width="410" height="170"
          >
            <text
              x="50%"
              y="50%"
              style="line-height: 1.7; font-size: 20px"
              text-anchor="middle">{{ content }}
            </text>
          </foreignObject>
          <text
            x="93%"
            y="89%"
            font-size="16px"
            class="sv-text-right"
            >{{ this.senderShortName }} さんより
          </text>
          <text
            x="93%"
            y="96%"
            font-size="14px"
            class="sv-text-right text-max"
            >(@{{ receivedLetter.sender.twitter_id }})
          </text>
        </svg>
      </div>
    </v-card>
  </v-dialog>
</template>
<script>
import axios from "axios";
import { mapGetters } from "vuex"
import SvgStyle from '../components/SvgStyle';

export default {
  name: "ShareLetterModal",
  components: {
    SvgStyle
  },
  props: {
    isVisibleShareLetterModal: {
      type: Boolean,
      required: true,
    },
    receivedLetter: {
      type: Object,
      required: true
    },
  },
  data() {
    return {
      shareImage: {
        letter_id: "",
        topic: "",
        image_url: '',
      },
      savedImageID: "",
      title: '',
      content: ''
    }
  },
  computed: {
    ...mapGetters({ currentUser: "users/currentUser" }),
    senderShortName() {
      const senderName = this.receivedLetter.sender.name
      return senderName.length <= 15 ? senderName: (senderName.substr(0, 15)+"...");
    },
  },
  methods: {
    handleCloseModal() {
      this.$emit("close-modal");
    },
    async addLetterTopicToSvg(letterTitle) {
      this.title = letterTitle.message
      this.content = letterTitle.content
      if (letterTitle.topic === "expect") {
        this.title = this.shortReceiverNameExpectCase()
      }
      this.$store.dispatch("flash/setFlash", {
        type: "success",
        message: "関数が実行されました。"
      })
    },
    postImage(letterTitle) {
      this.shareImage.letter_id = this.receivedLetter.letter.id
      this.shareImage.topic = letterTitle.topic
      axios.post("/api/share_images", { share_image: this.shareImage })
      .then((res) => {
        const savedImage = res.data
        console.log(res.data.image_url.url);
        this.savedImageID = savedImage.id
      })
      .catch((error) => {
        console.log(error);})
      .then(() => {
        const url = `https://goenbako.com/letters/${this.receivedLetter.letter.id}?twitter_id=${this.receivedLetter.receiver.twitter_id}%26id=${this.savedImageID}`
        location.href = `https://twitter.com/intent/tweet?text=${this.receivedLetter.sender.name}さん から素敵なファンレターが届いたよ！%0a°˖✧%23ご縁箱%20%23goenbako_letters✧˖°%0a&url=${url}`
      })
    },
    async shareTwitterAfterSvgToPngAndUpload(letterTitle) {
      const createCanvasFromSvgAndConversionPngUrl = (svgElement, urlCallback) => {
        const canvas = document.createElement("canvas");
        canvas.width = 614;
        canvas.height = 300;
        const ctx = canvas.getContext("2d");
        const image = new Image();
        image.onload = () => {
          ctx.drawImage(image, 0, 0, 614, 300);
          urlCallback(canvas.toDataURL());
        };
        const svgData = new XMLSerializer().serializeToString(svgElement);
        image.src = "data:image/svg+xml;charset=utf-8;base64," + btoa(unescape(encodeURIComponent(svgData)));
      };
      await this.addLetterTopicToSvg(letterTitle);
      await createCanvasFromSvgAndConversionPngUrl(this.$refs.svgArea, data => {
          this.shareImage.image_url = data
          this.postImage(letterTitle)
      })
      this.addLetterTopicToSvg(letterTitle).then(() =>
        createCanvasFromSvgAndConversionPngUrl(this.$refs.svgArea, data => {
          this.shareImage.image_url = data
          this.postImage(letterTitle)
      }))
    },
    letterTitles() {
      return [
        { message: '出会った当時の印象／エピソード', content: `${this.receivedLetter.letter.past}`, topic: "past" },
        { message: '現在の印象／どんな人？', content: `${this.receivedLetter.letter.current}`, topic: "current" },
        { message: '聞いてみたいこと／これから話してみたいこと',  content: `${this.receivedLetter.letter.future}`, topic: "future" },
        { message: `${this.receivedLetter.receiver.name}さんに期待していること`, content: `${this.receivedLetter.letter.expect}`, topic: "expect" },
        { message: 'メッセージ', content: `${this.receivedLetter.letter.message}`, topic: "message" }
      ]
      .filter(existsLetterItem => existsLetterItem.content)
      .map(existsLetterItem => existsLetterItem)
    },
    shortReceiverNameExpectCase() {
      const receiverName = this.receivedLetter.receiver.name
      return receiverName.length <= 12 ? this.title: (this.title.substr(0, 12)+"...さんに期待していること");
    },
  },
};
</script>

<style scoped>
.modal {
  display: block;
}
.m-font{
  font-size: 1.0em;
  font-weight: bold;
  line-height: 1;
  color: #2c281e;
}
.s-font{
  font-size: 0.65em;
  font-weight: bold;
  line-height: 1;
  color: #2c281e;
}
</style>
