<template>
  <v-dialog
    v-model="isVisibleShareLetterModal"
    @click:outside="handleCloseModal"
    max-width="640"
  >
    <v-card color="amber lighten-5">
      <v-card-title>
        <span class="m-font">レターをシェアする</span>
        <v-icon>mdi-email-edit-outline</v-icon>
      </v-card-title>
      <v-divider />
      <!-- シェア項目1 -->
    <div v-for="(letterTitle, index) in letterTitles()" :key="index">
      <v-col class="text-center mt-4">
        <div
          class="s-font"
        >{{ letterTitle.message }}</div>
        <v-card-actions class="justify-center">
          <v-btn
            color="blue"
            class="white--text"
            x-small
            :href="twitterShare()"
          >
            <v-icon>mdi-twitter</v-icon>
            シェアする
          </v-btn>
        </v-card-actions>
        <v-card-actions class="justify-center">
          <v-btn
            color="#FCFCFC"
            x-small
            @click="svgToPng(letterTitle)"
          >
            <v-icon>mdi-sync</v-icon>
            変換する
          </v-btn>
        </v-card-actions>
      </v-col>
    </div>
      <!-- 閉じる -->
      <v-row
        justify="center"
        class="ma-4"
      >
        <v-card-actions>
          <v-btn
            large
            @click="handleCloseModal"
          >
            閉じる
          </v-btn>
        </v-card-actions>
      </v-row>
<!-- SVG要素を非表示のまま変換(本番ではhiddenにする) -->
      <div>
        <img src="" id="converted-image">
      </div>
      <div>
        <svg ref="svgArea" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="600" height="314" viewBox="0 0 600 314"><path fill="#fbf1ff" d="M0 0h600v314H0z"/><path d="M29.802 294.27c-2.947 2.494-12.225 3.474-10.365-4.077 2.6.615 7.79.891 10.3-.267Z" fill="#918dd7"/><path d="M30.039 294.178c.2.92-4.051 1.563-4.38 1.845-.365-6.23-.077-5.129 4.317-6.189Z" fill="#918dd7"/><path d="M29.739 289.925c-3.193 2.063-15.908.572-7.227-3.81 2.655-.492 7.221-1.459 7.227 3.81Z" fill="#f2d83a"/><path d="M40.509 272.096c-.824.677-.587.416-.255-.16 2.188-5.866-4.094-1.2-1.043.491.311 7.042 5.782-1.913 1.298-.331Zm-.76-.711c-.53.494-.9-.5-.385-.885.579-.537.913.559.385.885Zm1.65 2.1c-.546.987-1.883.882-.754-.436.4-.546 1.188-.418.754.436Z" fill="#231815"/><path d="M42.562 267.23c-1.786.906-.674 4.816 1.151 3.732 1.803-.898.65-4.797-1.151-3.732Zm.318 2.847c-.722-.4-.612-2.065.246-2.045 1.09.035.915 2.592-.246 2.045Z" fill="#231815"/><path d="M47.506 267.802c-.374.558-1.208 1.529-1.561.208 1.633-.344 2.326-.968 1.234-2.215-2.448-1.535-2.8 4.512-.291 3.788.833-.153 1.628-1.677.618-1.781Zm-.609-1.013c-.218.08-.819.276-1.032.338-.038-.5.991-.918 1.032-.339ZM51.241 266.114c-1.173-3.535-3.864.625-2.011 2.835 1.047-.431-.471-2.906.883-3.126.676.084.355 1.9.491 2.475.935 1.716.773-1.607.637-2.184ZM54.04 264.914a.979.979 0 0 0-.727.215c.346-7.475-2.153 4.976-.246 3.383 2.039 1.973 3.367-3.288.973-3.598Zm.552 2.077a.837.837 0 0 1-.665.935.791.791 0 0 1-.735-.846 1.161 1.161 0 0 1 .018-.25.839.839 0 0 1 .665-.935.79.79 0 0 1 .735.846 1.161 1.161 0 0 1-.018.245Z" fill="#231815"/><path d="M58.03 268.186c1.5-3.923-3.5-2.324-1.268-1.552.143-.262.954-.117.7.417-4.681-.123 1.483 5.388.568 1.135Zm-.7-.254c.066.746-.884.971-.923.226.037-.305.63-.274.924-.226ZM61.965 268.392c.39-1.453-2.03-.071-1.772-.265-.071-.324 1.59-3.4.22-3.158-.209 1.049-2.412 5.235-1.044 5.513 1.005-2.844.486-.013 1.336.9 1.738-.582-1.339-2.241 1.26-2.99Z" fill="#231815"/><path d="M64.116 269.33c-1.705-1.418-3.214 2.264-1.539 3.466 1.693 1.432 3.191-2.263 1.539-3.466Zm-.364.82c.825.606.015 2.521-.8 1.812-.832-.608-.041-2.511.8-1.812Z" fill="#231815"/><path d="M77.36 298.396c-1.319-3.148 1.033-13.238 3.507-5.823-.305 4.841 1.504 6.404-3.507 5.823Z" fill="#918dd7"/><path d="M77.179 292.595a2.21 2.21 0 0 1 1.739-2.473 2.074 2.074 0 0 1 1.944 2.214v.241Z" fill="#f2d83a"/><path d="M77.179 292.45c1.007.353 4.434-1.125 3.684 1.6-1.005-.357-4.432 1.121-3.684-1.6Z" fill="#fff"/><path fill="none" d="M76.643 292.341h4.76M76.643 294.083h4.76"/><path d="M45.54 277.927c1.146-.023 1.146 2.415 0 2.4-1.146.015-1.146-2.421 0-2.4Z" fill="#918dd7"/><path d="M45.54 280.759c-1.568.03-1.568-3.3 0-3.271 1.568-.031 1.568 3.302 0 3.271Zm0-2.39c-.723-.015-.723 1.523 0 1.508.723.015.723-1.523 0-1.508Z"/><path d="M48.785 277.927c1.146-.023 1.146 2.415 0 2.4-1.147.015-1.147-2.421 0-2.4Z" fill="#f2d83a"/><path d="M48.785 280.759c-1.568.03-1.568-3.3 0-3.271 1.567-.031 1.567 3.302 0 3.271Zm0-2.39c-.723-.015-.723 1.523 0 1.508.723.015.723-1.523 0-1.508ZM45.791 281.575c-.945 1.326-9.127-.5-9.718 1.182-.273 1.354 7.5.372 7.89.655-.074 1.364-3.167 5.529.107 3.394.646-1.432 4.552-4.316 1.721-5.231ZM45.759 296.302c-4.077.54-7.763 1.381-9.483-3.044-4.177 4.595 11.125 7.399 9.483 3.044ZM68.96 293.983c-.281.56-1.524 1.009-1.363 1.708 1.056 1.969 3.574-2.495 1.363-1.708ZM74.582 294.939c-.713-.3-1.134-1.459-1.818-.912-.954 1.361 2.226 2.902 1.818.912Z"/><path d="M74.683 289.359c-.655-2.9-1.583.6-2.66.137.215-4.037-1.735-4.6-1.414-.114-2.746-.085-3.363 1.355-.082 1.116.52.7-.7 9.081.736 8.95 1.474.163.234-8.253.759-8.949.749-.12 2.713.533 2.661-1.14Z"/><path d="M74.46 281.24c-.54.772-2.961 1.1-3.734.705.959-5.408-1.824.557-2.726 2.6.177 1.347 1.723-.457 2.17-1.388.076-.131 1.176-.188 1.212.023-.245 2.736 1.57 2.25 1.414-.115 1.014.41 3.656-.613 1.664-1.825ZM81.916 281.24c-.535.775-2.881 1.1-3.667.705.995-5.4-1.835.542-2.708 2.6.518 1.955 2.218-2.6 3.365-1.365-.414 2.4 1.744 2.407 1.331 0 .855.061 3.828-.549 1.679-1.94ZM61.616 290.842c-1.014 1.875 1.462 6.737-1.551 6.452.163-.026 2.087 2.78 2.17 2.028.064-1.436 1.217-7.746-.619-8.48Z"/><path d="M60.716 295.575c.477-2-1.906-.15-2.187.573.46 1.616 1.662.366 2.187-.573ZM65.541 296.08a4.9 4.9 0 0 1-1.392-1.042c-2.513-.464 1.727 4.346 1.392 1.042ZM65.216 286.014c-3.515 4.821 1.064-8.5-2.575-5.417-.271.189-5.676-.646-3.784 1.025 1.571.326 4.476-1.276 3.733 2.322-.37.13-5.416-.578-3.415 1.154 1.492.331 4.012-1.231 3.416 2.075-.259.536-5.524-.551-5.4.614-.189 1.036 4.353.284 4.651.5-6.639 1.649 1.372 3.342 1.25 0 1.296.454 4.663-.608 2.124-2.273ZM55.943 290.657c-.932 1.658-1.732.878-3.308 1.036 1.031-1.042 5.114-7.264 1.672-5.639-1.176 1.792-1.859 5.748-3.91 5.651-1.935 1.713 1.645 1.245 2.149 1.5-.551 7.682 1.883 7.691 1.331 0-.071-.236 1.439-.065 1.494-.114.716 3.111 2.052-2.212.572-2.434Z"/><path d="M50.376 286.136c1.6 2.134 4.114 2.641 1.2-.56.635-.654 6.242-6.119 2.387-5.278-.196.724-4.713 4.916-3.587 5.838ZM50.949 294.642c-1.031-.021-1.031 2.173 0 2.152 1.03.02 1.03-2.173 0-2.152ZM55.44 294.642c-1.031-.021-1.032 2.173 0 2.152 1.032.02 1.032-2.173 0-2.152Z"/><path d="M60.377 291.844c-1.344-1.612-2.847 1.6-.982 1.959.844.063 2.099-1.123.982-1.959Z" fill="#f2d83a"/><path d="M59.437 294.244c-2.087-.055-1.256-4.29.674-3.07a1.6 1.6 0 0 1-.674 3.07Zm-.006-2.378c-2.264 1.537 2.039 2.038.773.354a1.4 1.4 0 0 0-.773-.354Z"/><path d="M63.557 291.762c.894-.848 2.238.122 1.688 1.541-.651 1.463-3.229-.543-1.688-1.541Z" fill="#918dd7"/><path d="M64.451 294.262c-1.092 0-2.62-1.786-1.041-2.892 1.948-1.777 3.416 2.664 1.041 2.892Zm-.737-2.111c-1.052.594.954 1.832 1.286.849.267-1.041-.661-1.4-1.288-.849ZM30.139 289.792c.017-2.3-1.224-4.3-2.982-4.807.831-2.145-1.719-2.353-2.071-.431a.359.359 0 0 0-.578-.116.343.343 0 0 0-.033.033c-.555-2.275-3.321-.788-1.735.943-3.843-.693-4.88 7.821-2.888 10.242 4.11.658 12.083 2.658 10.287-5.864Zm-.813-.228c-4.321 1.354-2.941.111-5.022-3.248 1.9-.814 2.18 1.082 2.879 2.813.78-.612-.155-2.419-.637-3.083 1.379-.205 2.645 1.532 2.78 3.518Zm-3.9-4.8c.491-1.72 2.271-.326.6.264-.181.006-.858.144-.597-.268Zm-2.569-.47c.374-.879 1.221.088 1.412.714-.442.231-1.486.078-1.412-.714Zm-.515 2.243c1.41-.037 2.408 1.437 2.589 3.718-2.309-.322-8.576-.274-2.586-3.722Zm-2.41 8.041c-.1-.009-.056-3.849-.09-3.907 3.472 1.059 5.7-1.533 5.184 4.716Zm9.422-.361-3.527 1.1c-.385-4.956.169-3.99 3.52-4.661-.042.059.137 3.572.007 3.563Z"/><path d="M24.509 278.546c-10.977-.208-10.978 23.117 0 22.9 10.977.212 10.979-23.113 0-22.9Zm0 21.414c-9.548.183-9.548-20.105 0-19.922 9.549-.183 9.55 20.108 0 19.922ZM82.251 288.614c-.779-1.041-.172-4.905-2.873-2.126a.414.414 0 0 0-.682-.036l-.028.036c-.983-1.885-3.575-.4-2.231 1.612-.6.265-1.66 1.6-.484 1.809.966-.714 1.936-2.2 3.071-2.144.731-.502 4.625 4.229 3.227.849Zm-4.127-1.556c-1.328.875-1.156-1.112.021-.017Zm1.942.091a1.261 1.261 0 0 1-.164-.1c.939-1.035 1.55.679.164.1Z"/><path d="M79.023 288.645c-3.377-.653-3.926 9.443-2.065 10.782.852-.335 4.959.927 4.967-1.137-.087-3.041.831-9.717-2.902-9.645Zm0 1.434a2.014 2.014 0 0 1 1.76 1.753h-3.52a2.01 2.01 0 0 1 1.76-1.753Zm1.842 8.073c-2.839.615-4.175 1.16-3.684-3.559 2.914.231 4.117-1.373 3.684 3.559Zm0-4.576c-.285-.292-4.373.738-3.684-.729.278.3 4.374-.736 3.684.729Z"/><path d="M76.161 38h445.677c16.52 0 29.912 12.317 29.912 27.511V225.99c0 15.193-13.392 27.51-29.912 27.51H76.161c-16.52 0-29.911-12.317-29.911-27.51V65.514C46.25 50.314 59.641 38 76.161 38Z" fill="#fff"/><path d="M77.316 95.364c-.15-.115-2.821.276-2.627-.25-.229-.358 3.575-.547 2.627.25ZM512.365 95.364c-.105-.121-5.416.285-5.128-.25-.156-.365 6.059-.728 5.128.25Zm-15.007 0c-.1-.121-5.413.285-5.126-.25-.156-.365 6.058-.728 5.126.25Zm-15 0c-.105-.121-5.414.285-5.127-.25-.16-.365 6.055-.728 5.123.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.163-.365 6.051-.728 5.119.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.166-.365 6.048-.728 5.116.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.169-.365 6.045-.728 5.113.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.172-.365 6.041-.728 5.109.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.173-.365 6.041-.728 5.109.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.174-.365 6.04-.728 5.108.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.177-.365 6.036-.728 5.105.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.178-.365 6.035-.728 5.104.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.179-.365 6.034-.728 5.103.25Zm-15 0c-.1-.121-5.414.285-5.127-.25-.18-.365 6.034-.728 5.103.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.182-.365 6.031-.728 5.1.25Zm-15 0c-.1-.121-5.412.285-5.126-.25-.182-.365 6.03-.728 5.099.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.184-.365 6.028-.728 5.097.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.185-.365 6.027-.728 5.096.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.187-.365 6.025-.728 5.094.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.187-.365 6.025-.728 5.094.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.188-.365 6.024-.728 5.093.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.189-.365 6.023-.728 5.092.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.19-.365 6.022-.728 5.091.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.191-.365 6.021-.728 5.09.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.19-.365 6.022-.728 5.091.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.192-.365 6.019-.728 5.088.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.193-.365 6.019-.728 5.088.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.193-.365 6.018-.728 5.083.25Zm-15 0c-.1-.121-5.411.285-5.125-.25-.194-.365 6.017-.728 5.083.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.195-.365 6.017-.728 5.083.25ZM524.816 95.364h-2.5c-1-.767 3.5-.767 2.5 0ZM77.316 130.364c-.15-.115-2.821.276-2.627-.25-.229-.358 3.575-.547 2.627.25ZM512.365 130.364c-.105-.121-5.416.285-5.128-.25-.156-.365 6.059-.728 5.128.25Zm-15.007 0c-.1-.121-5.413.285-5.126-.25-.156-.365 6.058-.728 5.126.25Zm-15 0c-.105-.121-5.414.285-5.127-.25-.16-.365 6.055-.728 5.123.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.163-.365 6.051-.728 5.119.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.166-.365 6.048-.728 5.116.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.169-.365 6.045-.728 5.113.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.172-.365 6.041-.728 5.109.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.173-.365 6.041-.728 5.109.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.174-.365 6.04-.728 5.108.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.177-.365 6.036-.728 5.105.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.178-.365 6.035-.728 5.104.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.179-.365 6.034-.728 5.103.25Zm-15 0c-.1-.121-5.414.285-5.127-.25-.18-.365 6.034-.728 5.103.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.182-.365 6.031-.728 5.1.25Zm-15 0c-.1-.121-5.412.285-5.126-.25-.182-.365 6.03-.728 5.099.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.184-.365 6.028-.728 5.097.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.185-.365 6.027-.728 5.096.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.187-.365 6.025-.728 5.094.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.187-.365 6.025-.728 5.094.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.188-.365 6.024-.728 5.093.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.189-.365 6.023-.728 5.092.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.19-.365 6.022-.728 5.091.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.191-.365 6.021-.728 5.09.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.19-.365 6.022-.728 5.091.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.192-.365 6.019-.728 5.088.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.193-.365 6.019-.728 5.088.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.193-.365 6.018-.728 5.083.25Zm-15 0c-.1-.121-5.411.285-5.125-.25-.194-.365 6.017-.728 5.083.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.195-.365 6.017-.728 5.083.25ZM524.816 130.364h-2.5c-1-.767 3.5-.767 2.5 0ZM77.316 165.364c-.15-.115-2.821.276-2.627-.25-.229-.358 3.575-.547 2.627.25ZM512.365 165.364c-.105-.121-5.416.285-5.128-.25-.156-.365 6.059-.728 5.128.25Zm-15.007 0c-.1-.121-5.413.285-5.126-.25-.156-.365 6.058-.728 5.126.25Zm-15 0c-.105-.121-5.414.285-5.127-.25-.16-.365 6.055-.728 5.123.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.163-.365 6.051-.728 5.119.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.166-.365 6.048-.728 5.116.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.169-.365 6.045-.728 5.113.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.172-.365 6.041-.728 5.109.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.173-.365 6.041-.728 5.109.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.174-.365 6.04-.728 5.108.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.177-.365 6.036-.728 5.105.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.178-.365 6.035-.728 5.104.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.179-.365 6.034-.728 5.103.25Zm-15 0c-.1-.121-5.414.285-5.127-.25-.18-.365 6.034-.728 5.103.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.182-.365 6.031-.728 5.1.25Zm-15 0c-.1-.121-5.412.285-5.126-.25-.182-.365 6.03-.728 5.099.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.184-.365 6.028-.728 5.097.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.185-.365 6.027-.728 5.096.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.187-.365 6.025-.728 5.094.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.187-.365 6.025-.728 5.094.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.188-.365 6.024-.728 5.093.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.189-.365 6.023-.728 5.092.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.19-.365 6.022-.728 5.091.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.191-.365 6.021-.728 5.09.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.19-.365 6.022-.728 5.091.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.192-.365 6.019-.728 5.088.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.193-.365 6.019-.728 5.088.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.193-.365 6.018-.728 5.083.25Zm-15 0c-.1-.121-5.411.285-5.125-.25-.194-.365 6.017-.728 5.083.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.195-.365 6.017-.728 5.083.25ZM524.816 165.364h-2.5c-1-.767 3.5-.767 2.5 0ZM77.316 200.364c-.15-.115-2.821.277-2.627-.25-.229-.358 3.575-.547 2.627.25ZM512.365 200.364c-.105-.121-5.416.286-5.128-.25-.156-.366 6.06-.728 5.128.25Zm-15.007 0c-.1-.121-5.414.286-5.126-.25-.156-.366 6.058-.728 5.126.25Zm-15 0c-.105-.121-5.414.286-5.127-.25-.16-.366 6.055-.728 5.123.25Zm-15 0c-.105-.121-5.413.286-5.126-.25-.163-.366 6.051-.728 5.119.25Zm-15 0c-.1-.121-5.413.286-5.126-.25-.166-.366 6.048-.728 5.116.25Zm-15 0c-.1-.121-5.413.286-5.126-.25-.169-.366 6.045-.728 5.113.25Zm-15 0c-.1-.121-5.412.286-5.125-.25-.172-.366 6.041-.728 5.109.25Zm-15 0c-.1-.121-5.413.286-5.126-.25-.173-.366 6.041-.728 5.109.25Zm-15 0c-.1-.121-5.413.286-5.126-.25-.174-.366 6.04-.728 5.108.25Zm-15 0c-.105-.121-5.413.286-5.126-.25-.177-.366 6.036-.728 5.105.25Zm-15 0c-.1-.121-5.413.286-5.126-.25-.178-.366 6.035-.728 5.104.25Zm-15 0c-.105-.121-5.413.286-5.126-.25-.179-.366 6.034-.728 5.103.25Zm-15 0c-.1-.121-5.414.286-5.127-.25-.18-.366 6.034-.728 5.103.25Zm-15 0c-.105-.121-5.413.286-5.126-.25-.182-.366 6.031-.728 5.1.25Zm-15 0c-.1-.121-5.412.285-5.126-.25-.182-.366 6.03-.728 5.099.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.184-.366 6.028-.728 5.097.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.185-.366 6.027-.728 5.096.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.187-.366 6.026-.728 5.094.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.187-.366 6.026-.728 5.094.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.188-.366 6.025-.728 5.093.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.189-.366 6.024-.728 5.092.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.19-.366 6.022-.728 5.091.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.191-.366 6.022-.728 5.09.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.191-.366 6.022-.728 5.091.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.193-.366 6.02-.728 5.088.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.193-.366 6.019-.728 5.088.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.194-.366 6.019-.728 5.083.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.195-.366 6.018-.728 5.083.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.195-.366 6.017-.728 5.083.25ZM524.816 200.364c-.186-.143-3.368.41-2.5-.5.19.143 3.372-.41 2.5.5ZM79.316 235.364c-.15-.115-2.821.277-2.627-.25-.229-.358 3.575-.547 2.627.25ZM514.365 235.364c-.105-.121-5.416.286-5.128-.25-.156-.366 6.06-.728 5.128.25Zm-15.007 0c-.1-.121-5.414.286-5.126-.25-.156-.366 6.058-.728 5.126.25Zm-15 0c-.105-.121-5.414.286-5.127-.25-.16-.366 6.055-.728 5.123.25Zm-15 0c-.105-.121-5.413.286-5.126-.25-.163-.366 6.051-.728 5.119.25Zm-15 0c-.1-.121-5.413.286-5.126-.25-.166-.366 6.048-.728 5.116.25Zm-15 0c-.1-.121-5.413.286-5.126-.25-.169-.366 6.045-.728 5.113.25Zm-15 0c-.1-.121-5.412.286-5.125-.25-.172-.366 6.041-.728 5.109.25Zm-15 0c-.1-.121-5.413.286-5.126-.25-.173-.366 6.041-.728 5.109.25Zm-15 0c-.1-.121-5.413.286-5.126-.25-.174-.366 6.04-.728 5.108.25Zm-15 0c-.105-.121-5.413.286-5.126-.25-.177-.366 6.036-.728 5.105.25Zm-15 0c-.1-.121-5.413.286-5.126-.25-.178-.366 6.035-.728 5.104.25Zm-15 0c-.105-.121-5.413.286-5.126-.25-.179-.366 6.034-.728 5.103.25Zm-15 0c-.1-.121-5.414.286-5.127-.25-.18-.366 6.034-.728 5.103.25Zm-15 0c-.105-.121-5.413.286-5.126-.25-.182-.366 6.031-.728 5.1.25Zm-15 0c-.1-.121-5.413.285-5.126-.25-.183-.366 6.03-.728 5.099.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.184-.366 6.028-.728 5.097.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.185-.366 6.027-.728 5.096.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.187-.366 6.026-.728 5.094.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.187-.366 6.026-.728 5.094.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.188-.366 6.025-.728 5.093.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.189-.366 6.024-.728 5.092.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.19-.366 6.022-.728 5.091.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.191-.366 6.022-.728 5.09.25Zm-15 0c-.105-.121-5.413.285-5.126-.25-.191-.366 6.022-.728 5.091.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.193-.366 6.02-.728 5.088.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.193-.366 6.019-.728 5.088.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.194-.366 6.019-.728 5.083.25Zm-15 0c-.1-.121-5.412.285-5.125-.25-.195-.366 6.018-.728 5.083.25Zm-15 0c-.105-.121-5.412.285-5.125-.25-.195-.366 6.017-.728 5.083.25ZM526.816 235.364c-.186-.143-3.368.41-2.5-.5.19.143 3.372-.41 2.5.5Z"/>
          <SvgStyle />
          <text
            x="15%"
            y="14%"
            class="sv-style"
            font-size="14px"
            ><tspan>>{{ title }}</tspan>
          </text>
          <foreignObject
            x="16%" y="20%" width="410" height="170"
          >
            <text
              x="50%"
              y="50%"
              style="line-height: 1.7; font-size: 20px"
              text-anchor="middle">{{ content }}
            </text>
          </foreignObject>
          <text
            x="95%"
            y="90%"
            font-size="14px"
            class="sv-text-right"
            >{{ receivedLetter.sender.name }} さんより
          </text>
          <text
            x="95%"
            y="96%"
            font-size="10px"
            class="sv-text-right"
            >(@{{ receivedLetter.sender.twitter_id }})
          </text>
        </svg>
      </div>
    </v-card>
  </v-dialog>
</template>
<script>
import axios from "axios";
import { mapGetters } from "vuex"
import SvgStyle from '../components/SvgStyle';
export default {
  name: "ShareLetterModal",
  components: {
    SvgStyle
  },
  props: {
    isVisibleShareLetterModal: {
      type: Boolean,
      required: true,
    },
    receivedLetter: {
      type: Object,
      required: true
    },
  },
  data() {
    return {
      shareImage: {
        letter_id: "",
        topic: "",
        image_url: '',
      },
      savedImageID: "",
      title: '',
      content: ''
    }
  },
  computed: {
    ...mapGetters({ currentUser: "users/currentUser" }),
  },
  methods: {
    handleCloseModal() {
      this.$emit("close-modal");
    },
    postImage(letterTitle) {
      this.shareImage.letter_id = this.receivedLetter.letter.id
      this.shareImage.topic = letterTitle.topic
      axios.post("/api/share_images", { share_image: this.shareImage })
      .then((res) => {
          const savedImage = res.data
          this.savedImageID = savedImage.id
          console.log(this.savedImageID);
      })
      .catch((error) => {
        console.log(error);
      })
    },
    twitterShare() {
      const url = `https://goenbako.com/${this.currentUser.twitter_id}/letters/${this.receivedLetter.letter.id}/?id=${this.savedImageID}`
      return `https://twitter.com/intent/tweet?text=${this.receivedLetter.sender.name}さん から素敵なファンレターが届いたよ！%0a&hashtags=ご縁箱&hashtags=goenbako_letters%0a&url=${url}`;
    },
    async svgToPng(letterTitle) {
      await this.addLetterTopicToPng(letterTitle);
      const createCanvasFromSvgAndConversionPngUrl = (svgElement, urlCallback) => {
        const canvas = document.createElement("canvas");
        canvas.width = 614;
        canvas.height = 300;
        const ctx = canvas.getContext("2d");
        const image = new Image();
        image.onload = () => {
          ctx.drawImage(image, 0, 0, 614, 300);
          urlCallback(canvas.toDataURL());
        };
        const svgData = new XMLSerializer().serializeToString(svgElement);
        image.src = "data:image/svg+xml;charset=utf-8;base64," + btoa(unescape(encodeURIComponent(svgData)));
      };
      await createCanvasFromSvgAndConversionPngUrl(this.$refs.svgArea, data => {
        document.getElementById('converted-image').src = data; // dev
      });
      createCanvasFromSvgAndConversionPngUrl(this.$refs.svgArea, data => {
        document.getElementById('converted-image').src = data; // dev
        this.shareImage.image_url = data;
        console.log(this.shareImage.image_url); // dev
        this.postImage(letterTitle);
      });
    },
    letterTitles() {
      return [
        { message: '出会った当時の印象／エピソード', content: `${this.receivedLetter.letter.past}`, topic: "past" },
        { message: '現在の印象／どんな人？', content: `${this.receivedLetter.letter.current}`, topic: "current" },
        { message: '聞いてみたいこと／これから話してみたいこと',  content: `${this.receivedLetter.letter.future}`, topic: "future" },
        { message: `${this.receivedLetter.receiver.name}さんに期待していること`, content: `${this.receivedLetter.letter.expect}`, topic: "expect" },
        { message: 'メッセージ', content: `${this.receivedLetter.letter.message}`, topic: "message" }
      ]
      .filter(existsLetterItem => existsLetterItem.content)
      .map(existsLetterItem => existsLetterItem)
    },
    addLetterTopicToPng(letterTitle) {
      this.title = letterTitle.message
      this.content = letterTitle.content
    }
  },
};
</script>

<style scoped>
.modal {
  display: block;
}
.m-font{
  font-size: 1.1em;
  font-weight: bold;
  line-height: 1;
  color: #2c281e;
}
.s-font{
  font-size: 0.65em;
  font-weight: bold;
  line-height: 1;
  color: #2c281e;
}
</style>
